---
import SmartEcosystem from "@/components/SmartEcosystem.astro";
import Areas from "@/components/Areas.astro";
import Service from "@/components/Service.astro";
import Contact from "@/components/Contact.astro";
import SuccessStories from "@/components/SuccessStories.astro";
import Layout from "@/layouts/Layout.astro";

import { useTranslation, slugify } from "@/i18n";
import { translations } from "@/i18n/config";
import Stars from "@/components/Stars.astro";

export async function getStaticPaths() {
  const paths: any[] = [];
  for (const lang of Object.keys(translations)) {
    const t = await (translations as any)[lang]();
    const items = t.AREAS.SMART_ECOSYSTEM_ITEMS;
    if (items && Array.isArray(items)) {
      for (const item of items) {
        if (item.TITLE_TEXT) {
          paths.push({ params: { lang, slug: slugify(item.TITLE_TEXT) } });
        }
      }
    }
  }
  return paths;
}

const { lang, slug } = Astro.params;

// Redirigimos a la p치gina de inicio en espa침ol como opci칩n por defecto.
if (!lang) {
  return Astro.redirect("/es/");
}

const t = await useTranslation(lang as any);

const item = t.AREAS.SMART_ECOSYSTEM_ITEMS.find(
  (i: any) => slugify(i.TITLE_TEXT) === slug
);

// Si no se encuentra el elemento, redirigir a la p치gina de inicio del idioma actual.
if (!item) {
  return Astro.redirect(`/${lang}/`);
}
---

<Layout title={item.TITLE_TEXT}>
  <SmartEcosystem item={{ TITLE: item.TITLE, DESCRIPTION: item.DESCRIPTION }} />
  <Areas item={item} />
  <Service service={item.SERVICE} title={item.TITLE_SERVICE} />
  <SuccessStories projects={item.PROJECTS} />
  <Contact />
  <div class="h-full w-full fixed top-0 left-0 -z-10 pointer-events-none">
    <Stars />
  </div>
</Layout>
