---
import { getLangFromUrl, useTranslation } from "@/i18n";
import Stars from "./Stars.astro";

const lang = getLangFromUrl(Astro.url);
const i18n = await useTranslation(lang);
---

<div
  id="about"
  class="z-[5] box-border relative mx-auto border-white/25 border-t w-full h-auto md:min-h-[1700px] overflow-hidden"
>
  <Stars />
  <!-- TEXTOS -->
  <div
    id="textos"
    class="top-[50px] md:right-0 md:left-0 z-[20] md:absolute relative flex md:flex-row flex-col mx-auto w-full md:max-w-[1200px]"
  >
    <div
      class="flex flex-col items-center md:items-start p-4 md:p-0 w-full md:w-auto md:text-left text-center"
    >
      <!-- TEXTO 1 -->
      <div
        id="textos1"
        class="md:top-0 md:left-0 md:absolute w-full md:w-[560px]"
      >
        <div
          class="md:pl-5 os-animation"
          data-anim="fadeInLeft"
          style="--delay:1s"
        >
          <h2
            class="font-normal text-[32px] text-white md:text-[45px] leading-[1.1]"
          >
            <span class="text-[var(--color-title)]">+ {i18n.ABOUT.LABEL}</span>
            {i18n.ABOUT.TITLE1}
          </h2>

          <p class="mt-6 font-light text-white text-lg leading-[150%]">
            {i18n.ABOUT.TEXT1}
          </p>
        </div>
      </div>

      <!-- TEXTO 2 -->
      <div
        id="textos2"
        class="md:top-[770px] md:right-0 md:absolute mt-8 md:mt-0 w-full md:w-[456px] md:text-right"
      >
        <div
          class="md:pr-5 os-animation"
          data-anim="fadeInLeft"
          style="--delay:1s"
        >
          <p class="font-semibold text-[var(--color-title)] text-sm uppercase">
            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ {i18n.ABOUT.LABEL}
          </p>

          <h2 class="mt-4 text-3xl leading-snug">
            <span class="text-[var(--color-title)]">+</span>
            <span class="text-white">
              {i18n.ABOUT.TITLE2}
            </span>
          </h2>

          <p class="mt-2 font-light text-white text-lg leading-[150%]">
            {i18n.ABOUT.TEXT2}
          </p>
        </div>
      </div>

      <!-- TEXTO 3 -->
      <div
        id="textos3"
        class="md:top-[1300px] md:left-0 md:absolute mt-8 md:mt-0 w-full md:w-[550px]"
      >
        <div
          class="md:pl-5 os-animation"
          data-anim="fadeInLeft"
          style="--delay:1s"
        >
          <p class="font-semibold text-[var(--color-title)] text-sm uppercase">
            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ {i18n.ABOUT.LABEL}
          </p>

          <h2 class="mt-4 text-white text-3xl leading-snug">
            <span class="text-[var(--color-title)]">+</span>
            {i18n.ABOUT.TITLE3}
          </h2>

          <p class="mt-2 font-light text-white text-lg leading-[150%]">
            {i18n.ABOUT.TEXT3}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- EDIFICIOS -->
  <div
    id="edificio"
    class="hidden md:block top-1/2 left-1/2 z-[10] absolute w-full max-w-[1200px] -translate-x-1/2 -translate-y-1/2 pointer-events-none"
    style="aspect-ratio:1200 / 1510;"
  >
    {
      [
        { id: 1, img: "e1.png", anim: "fadeIn", delay: "1s", z: 10 },
        {
          id: 2,
          img: "e3.png",
          anim: "fadeInDown",
          delay: "3s",
          brilla: true,
          blink: "0s",
          z: 30,
        }, // ðŸ‘ˆ arriba
        {
          id: 3,
          img: "e5.png",
          anim: "fadeInDown",
          delay: "5s",
          brilla: true,
          blink: "1.5s",
          z: 20,
        },
        { id: 4, img: "e4.png", anim: "fadeInUp", delay: "4s", z: 15 },
        { id: 5, img: "e2.png", anim: "fadeInUp", delay: "2s", z: 12 },
        {
          id: 6,
          img: "e6.png",
          anim: "fadeInUp",
          delay: "6s",
          brilla: true,
          blink: "3s",
          z: 18,
        },
      ].map((e) => (
        <div
          id={`edificio${e.id}`}
          class="top-0 left-1/2 absolute w-full max-w-[1200px] -translate-x-1/2"
          style={`aspect-ratio:1200 / 1510; z-index:${e.z ?? 10};`}
        >
          <div
            class="os-animation"
            data-anim={e.anim}
            style={`--delay:${e.delay}`}
          >
            <img
              src={`/imagenes/${e.img}`}
              class={`${e.brilla ? "brilla" : ""} w-full h-auto object-contain`}
              style={e.brilla ? `--blink-delay:${e.blink || "0s"}` : ""}
              alt={`edificio-${e.id}`}
            />
          </div>
        </div>
      ))
    }
  </div>

  <center class="md:hidden">
    <img
      src="/imagenes/edificios.png"
      id="edimagen"
      class="w-full max-w-[1200px] h-auto object-contain"
      alt="edificios"
    />
  </center>
</div>

<script is:inline>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((e) => {
        if (e.isIntersecting) {
          const el = e.target;
          el.classList.add("animated", el.dataset.anim);
          el.style.animationDelay =
            getComputedStyle(el).getPropertyValue("--delay");
          observer.unobserve(el);
        }
      });
    },
    { threshold: 0.2 }
  );

  document
    .querySelectorAll(".os-animation")
    .forEach((el) => observer.observe(el));
</script>
<style>
  .os-animation {
    opacity: 0;
  }
  .os-animation.animated {
    opacity: 1;
  }

  .brilla {
    animation: blinkGlow 2.5s ease-in-out infinite;
    animation-delay: var(--blink-delay);
  }

  @keyframes blinkGlow {
    0% {
      opacity: 1;
    }
    50% {
      opacity: 0.4;
      filter: brightness(1.35);
    }
    100% {
      opacity: 1;
    }
  }
</style>
