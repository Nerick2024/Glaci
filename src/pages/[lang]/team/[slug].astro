---
import Layout from '@/layouts/Layout.astro';
import { getLangFromUrl, useTranslation, useTranslatedPath, slugify, translations, type Locale } from '@/i18n';

export async function getStaticPaths() {
    const paths = [];

    for (const lang of Object.keys(translations) as Locale[]) {
        const t = await translations[lang]();
        if (t.TEAM && t.TEAM.TEAM) {
            for (const member of t.TEAM.TEAM) {
                if (member.NAME) {
                    paths.push({
                        params: {
                            lang: lang,
                            slug: slugify(member.NAME)
                        }
                    });
                }
            }
        }
    }

    return paths;
}

const { lang, slug } = Astro.params;

// Ensure lang and slug are present
if (!lang || !slug) {
  return new Response(null, { status: 404, statusText: 'Not found' });
}

const i18n = await useTranslation(lang);

// Find the team member by comparing the slugified name with the slug from the URL
const member = i18n.TEAM.TEAM.find(member => slugify(member.NAME) === slug);

// If no member is found, return a 404
if (!member) {
  return new Response(null, { status: 404, statusText: 'Not found' });
}

const { NAME, POSITION, SEMBLANCE, IMG } = member;
---

<Layout title={NAME}>
  <section class="mx-auto my-12 max-w-4xl px-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
      <div>
        <img src={IMG} alt={NAME} class="w-full h-auto object-cover rounded-lg shadow-lg" />
      </div>
      <div class="text-white">
        <h1 class="text-4xl font-bold mb-2">{NAME}</h1>
        <h2 class="text-xl font-semibold text-gray-300 mb-4">{POSITION}</h2>
        <p class="text-gray-400">{SEMBLANCE}</p>
      </div>
    </div>
    <div class="mt-12 text-center">
      <a href={useTranslatedPath(lang)('/') + 'our-team'} class="text-white bg-gray-800 hover:bg-gray-900 font-bold py-3 px-6 rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
        {i18n.TEAM.BACK_BUTTON}
      </a>
    </div>
  </section>
</Layout>
