---
import { getLangFromUrl, useTranslation, slugify } from "@/i18n";

const lang = getLangFromUrl(Astro.url);
const i18n = await useTranslation(lang);

const smartEcosystemItems = i18n.AREAS.SMART_ECOSYSTEM_ITEMS;
const currentYear = new Date().getFullYear();

const nodeLayouts = [
  {
    transform: "translate(119.474, 200)",
    gClass: "group left cursor-pointer item",
    foProps: { x: -200, y: -50, width: 200, height: 100 },
    divClass: "flex flex-col justify-center h-full text-center",
  },
  {
    transform: "translate(310, 90)",
    gClass: "group cursor-pointer item up",
    foProps: { x: -100, y: -135, width: 200, height: 100 },
    divClass: "flex flex-col justify-end h-full text-center",
  },
  {
    transform: "translate(500.526, 200)",
    gClass: "group right cursor-pointer item",
    foProps: { x: 0, y: -50, width: 200, height: 100 },
    divClass: "flex flex-col justify-center h-full text-center",
  },
  {
    transform: "translate(500.526, 420)",
    gClass: "group right cursor-pointer item",
    foProps: { x: 0, y: -50, width: 200, height: 100 },
    divClass: "flex flex-col justify-center h-full text-center",
  },
  {
    transform: "translate(310, 530)",
    gClass: "group cursor-pointer item down",
    foProps: { x: -100, y: 35, width: 200, height: 100 },
    divClass: "text-center",
  },
  {
    transform: "translate(119.474, 420)",
    gClass: "group left cursor-pointer item",
    foProps: { x: -200, y: -50, width: 200, height: 100 },
    divClass: "flex flex-col justify-center h-full text-center",
  },
];
---

<main
  id="hero"
  class="relative lg:flex flex-col justify-center items-center pt-28 min-h-screen overflow-hidden"
>
  <!-- BACKGROUND -->
  <div class="-z-20 absolute inset-0 w-full h-full overflow-hidden">
    <video
      id="bg-video"
      class="border-0 w-full h-full object-cover pointer-events-none"
      src="/video/blue-2.mp4"
      autoplay
      muted
      loop
      playsinline></video>
  </div>

  <!-- DESKTOP VIEW -->
  <div class="hidden lg:block w-screen lg:h-[500px] 2xl:h-[700px] diagram">
    <svg
      data-aos="zoom-in"
      class="w-full h-full overflow-visible"
      viewBox="0 0 620 620"
    >
      <defs>
        <mask id="nodes-mask">
          <rect width="100%" height="100%" fill="white"></rect>
          <circle cx="310" cy="90" r="12" fill="black"></circle>
          <circle cx="500.526" cy="200" r="12" fill="black"></circle>
          <circle cx="500.526" cy="420" r="12" fill="black"></circle>
          <circle cx="310" cy="530" r="12" fill="black"></circle>
          <circle cx="119.474" cy="420" r="12" fill="black"></circle>
          <circle cx="119.474" cy="200" r="12" fill="black"></circle>
        </mask>
      </defs>
      <polygon
        class="poly"
        mask="url(#nodes-mask)"
        points="310,90 500.526,200 500.526,420 310,530 119.474,420 119.474,200"
      ></polygon>
      {
        smartEcosystemItems.map((item, index) => {
          const layout = nodeLayouts[index];
          return (
            <a href={`/${lang}/${slugify(item.TITLE_TEXT)}`}>
              <g class={layout.gClass} transform={layout.transform}>
                <circle class="outer-node" r="12" />
                <circle class="inner-node" r="5" />
                <foreignObject
                  data-aos="zoom-in"
                  data-aos-duration="1500"
                  data-aos-delay="200"
                  {...layout.foProps}
                >
                  <div class={layout.divClass}>
                    <span class="font-bold text-[#bdbdbd] text-[11px]">
                      0{index + 1}.
                    </span>
                    <span
                      class="block text-[13px] text-white"
                      set:html={item.TITLE}
                    />
                  </div>
                </foreignObject>
              </g>
            </a>
          );
        })
      }
    </svg>
    <div
      class="absolute w-1/2 top-1/2 left-1/2 -translate-1/2 -translate-y-1/2 text-center"
    >
      <p class="text-[#bdbdbd] text-[30px] mb-0 leading-1">
        {i18n.HERO.CENTER_SUBTITLE}
      </p>
      <p class="text-white font-extrabold text-[56px]">
        {i18n.HERO.CENTER_TITLE}
      </p>
    </div>
  </div>
  <div
    class="hidden bottom-0 items-end lg:grid grid-cols-3 px-28 w-full text-white"
  >
    <div class="flex flex-col justify-center items-center gap-6 w-fit">
      <p
        class="w-fit font-semibold text-[var(--color-title)] text-xl text-center"
      >
        <span class="font-extrabold">+</span>
        {i18n.HERO.FOOTER_LEFT_LINE1}<br />{i18n.HERO.FOOTER_LEFT_LINE2}
      </p>
      <a
        href={`/${lang}/certifications`}
        class="group flex justify-between items-center gap-4 bg-white px-6 py-3 rounded-full w-fit font-bold text-black text-lg"
      >
        {i18n.HERO.FOOTER_LEFT_BUTTON}
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="fill-black h-6 rotate-90"
          viewBox="0 0 16 16"
        >
          <path
            fill-rule="evenodd"
            d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5"
          ></path>
        </svg>
      </a>
    </div>
    <div class="flex justify-center animate-bounce duration-1000">
      <a href="#about" class="px-0.5 py-4 border-[1.8px] rounded-full">
        <img
          src="/icons/arrow.svg"
          alt="arrow"
          class="w-8 h-auto object-contain rotate-180"
        />
      </a>
    </div>
    <div class="flex flex-row justify-end items-center gap-6">
      <p class="font-light text-sm">{i18n.HERO.FOOTER_RIGHT_TEXT}</p>
      <div class="flex items-center gap-3">
        {
          i18n.NETWORKS.map((item) => (
            <a href={item.HREF} class="hover:scale-110 transition-all">
              <img src={item.IMG} alt={item.TITLE} class="w-auto h-10" />
            </a>
          ))
        }
      </div>
    </div>
  </div>

  <!-- MOBILE/TABLET VIEW -->
  <div
    class="lg:hidden flex flex-col justify-center items-center m-auto px-10 pt-12 w-full h-screen text-white"
  >
    <h1 class="font-light text-gray-300 text-3xl text-center">
      {i18n.HERO.CENTER_SUBTITLE}
    </h1>
    <h2 class="mt-1 mb-10 font-semibold text-5xl text-center">
      {i18n.HERO.CENTER_TITLE}
    </h2>
    <div class="flex flex-col gap-4 w-full max-w-md">
      {
        smartEcosystemItems.map((item) => (
          <a
            href={`/${lang}/${slugify(item.TITLE_TEXT)}`}
            class="block bg-black/25 hover:bg-white/10 bg-opacity-25 backdrop-blur-sm px-5 py-2.5 border border-white/20 rounded-full font-semibold text-center transition-colors duration-300"
          >
            {item.TITLE_TEXT}
          </a>
        ))
      }
    </div>
    <div class="flex flex-col items-center gap-6 mt-5 text-center">
      <p class="font-semibold text-[var(--color-title)] text-base">
        <span class="font-extrabold">+</span>
        {i18n.HERO.FOOTER_LEFT_LINE1}<br />{i18n.HERO.FOOTER_LEFT_LINE2}
      </p>
      <a
        href="/#somos"
        class="group flex items-center gap-3 bg-white px-8 py-3 rounded-full w-fit font-bold text-black text-lg"
      >
        {i18n.HERO.FOOTER_LEFT_BUTTON}
        <span
          class="font-bold text-xl transition-transform group-hover:translate-x-1"
          >→</span
        >
      </a>
    </div>
    <div class="mt-5 text-center">
      <p class="mb-4 font-light text-sm">{i18n.HERO.FOOTER_RIGHT_TEXT}</p>
      <div class="flex justify-center items-center gap-4">
        {
          i18n.NETWORKS.map((item) => (
            <a href={item.HREF} class="hover:scale-110 transition-all">
              <img src={item.IMG} alt={item.TITLE} class="w-auto h-9" />
            </a>
          ))
        }
      </div>
    </div>
  </div>
  <div
    class="bottom-0 left-0 -z-10 absolute bg-gradient-to-t from-[var(--color-bg-1)] to-transparent w-full h-1/6"
  >
  </div>
</main>

<footer class="px-8 lg:px-28 py-4 lg:text-left text-center">
  <p class="text-white/80 text-sm">Copyright © OM SMART {currentYear}</p>
</footer>

<style>
  .poly {
    fill: none;
    stroke: rgba(255, 255, 255, 0.18);
    stroke-width: 1.6;
  }
  @keyframes blink {
    50% {
      opacity: 0.3;
    }
  }
  .outer-node {
    fill: transparent;
    stroke: rgba(255, 255, 255, 0.9);
    stroke-width: 1.6px;
    transition: stroke 0.3s ease;
  }
  .inner-node {
    fill: rgba(255, 255, 255, 0.9);
    animation: blink 1s infinite ease-in-out;
    transition:
      r 0.3s ease,
      fill 0.3s ease,
      filter 0.3s ease;
  }
  .item:hover .inner-node {
    animation: none;
    r: 12;
    fill: var(--color-title);
    filter: drop-shadow(0 0 15px var(--color-title))
      drop-shadow(0 0 5px var(--color-title)) brightness(1.3);
  }
  .item:hover .outer-node {
    stroke: transparent;
  }
  strong {
    font-weight: 800; /* font-extrabold */
    font-size: 14px; /* text-[14px] */
  }
</style>
