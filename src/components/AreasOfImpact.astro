---
import { getLangFromUrl, useTranslation, slugify } from "@/i18n";
import Button_Networks from "@/components/Button_Networks.astro";

const lang = getLangFromUrl(Astro.url);
const i18n = await useTranslation(lang);

const smartEcosystemItems = i18n.AREAS.SMART_ECOSYSTEM_ITEMS;

const nodeLayouts = [
  {
    transform: "translate(119.474, 200)",
    gClass: "group left cursor-pointer item",
    foProps: { x: -200, y: -50, width: 200, height: 150 },
    divClass: "flex flex-col items-center justify-center h-full text-center gap-2 pb-1.5",
  },
  {
    transform: "translate(310, 90)",
    gClass: "group cursor-pointer item up",
    foProps: { x: -100, y: -180, width: 200, height: 150 },
    divClass: "flex flex-col items-center justify-end h-full text-center gap-2 pb-1.5",
  },
  {
    transform: "translate(500.526, 200)",
    gClass: "group right cursor-pointer item",
    foProps: { x: 0, y: -50, width: 200, height: 150 },
    divClass: "flex flex-col items-center justify-center h-full text-center gap-2 pb-1.5",
  },
  {
    transform: "translate(500.526, 420)",
    gClass: "group right cursor-pointer item",
    foProps: { x: 0, y: -50, width: 200, height: 150 },
    divClass: "flex flex-col items-center justify-center h-full text-center gap-2 pb-1.5",
  },
  {
    transform: "translate(310, 530)",
    gClass: "group cursor-pointer item down",
    foProps: { x: -100, y: 20, width: 200, height: 150 },
    divClass: "flex flex-col items-center justify-center h-full text-center gap-2 pb-1.5",
  },
  {
    transform: "translate(119.474, 420)",
    gClass: "group left cursor-pointer item",
    foProps: { x: -200, y: -50, width: 200, height: 150 },
    divClass: "flex flex-col items-center justify-center h-full text-center gap-2 pb-1.5",
  },
];
---

<div
  id="AreasOfImpact"
  class="relative lg:flex flex-col justify-between max-w-6xl gap-6 mx-auto items-center py-10"
>
  <h1
    class="mt-4 text-center font-normal text-[32px] text-white md:text-[45px]"
  >
    <span class="text-[var(--color-title)]">+</span>
    {i18n.AREAS.TITLE}
    <span class="text-[var(--color-title)]">+</span>
  </h1>
  <p class="text-white text-center lg:text-left text-lg">{i18n.AREAS.TEXT}</p>

  <!-- DESKTOP VIEW -->
  <div
    class="relative hidden lg:block diagram w-full max-w-2xl h-auto m-auto my-20"
  >
    <svg
      data-aos="zoom-in"
      class="w-full h-full overflow-visible"
      viewBox="0 0 620 620"
    >
      <defs>
        <mask id="nodes-mask">
          <rect width="100%" height="100%" fill="white"></rect>
          <circle cx="310" cy="90" r="12" fill="black"></circle>
          <circle cx="500.526" cy="200" r="12" fill="black"></circle>
          <circle cx="500.526" cy="420" r="12" fill="black"></circle>
          <circle cx="310" cy="530" r="12" fill="black"></circle>
          <circle cx="119.474" cy="420" r="12" fill="black"></circle>
          <circle cx="119.474" cy="200" r="12" fill="black"></circle>
        </mask>
      </defs>
      <polygon
        class="poly"
        mask="url(#nodes-mask)"
        points="310,90 500.526,200 500.526,420 310,530 119.474,420 119.474,200"
      ></polygon>
      {
        smartEcosystemItems.map((item, index) => {
          const layout = nodeLayouts[index];
          return (
            <a href={`/${lang}/${slugify(item.TITLE_TEXT)}`}>
              <g class={layout.gClass} transform={layout.transform}>
                <circle class="outer-node" r="12" />
                <circle class="inner-node" r="5" />
                <foreignObject
                  data-aos="zoom-in"
                  data-aos-duration="1500"
                  data-aos-delay="200"
                  {...layout.foProps}
                >
                  <div class={layout.divClass}>
                    <span class="font-bold text-[#bdbdbd] text-[12px]">
                      0{index + 1}.
                    </span>
                    <span
                      class="block text-white text-[18px] 2xl:text-[20px] leading-5"
                      set:html={item.TITLE}
                    />
                    <div class="w-12 h-12 mx-auto border border-[var(--color-title)] rounded-full p-2">
                    <img src={item.ICON} alt={item.TITLE_TEXT} class="w-full h-full object-contain" />
                    </div>
                  </div>
                </foreignObject>
              </g>
            </a>
          );
        })
      }
    </svg>
    <div
      class="absolute w-1/2 top-1/2 left-1/2 -translate-1/2 -translate-y-1/2 text-center"
    >
      <p
        class="center-title text-3d-center text-white font-extrabold lg:text-4xl 2xl:text-6xl"
      >
        {i18n.HERO.CENTER_TITLE}
      </p>
    </div>
  </div>

  <!-- MOBILE/TABLET VIEW -->
  <div
    class="lg:hidden flex flex-col justify-center items-center m-auto p-10 w-full h-fit text-white"
  >
    <p class="center-title text-3d-center text-6xl font-extrabold mb-6">
      {i18n.HERO.CENTER_TITLE}
    </p>
    <div class="flex flex-wrap gap-4 w-full justify-center max-w-md">
      {
        smartEcosystemItems.map((item) => (
          <a
            href={`/${lang}/${slugify(item.TITLE_TEXT)}`}
            class="relative flex bg-white/5 hover:bg-white/20 backdrop-blur-sm px-5 py-2.5 border border-white/20 rounded-lg transition-colors duration-300 w-[45%] items-center justify-center"
          >
            <p class="font-semibold text-center">{item.TITLE_TEXT} </p>
            <div class="absolute bg-[var(--color-title)] h-0.5 w-2/3 rounded-full -bottom-0.5" />
          </a>
        ))
      }
    </div>
  </div>
  <p class="text-white text-center lg:text-left text-lg">{i18n.AREAS.TEXT_2}</p>
</div>

<style>
  .poly {
    fill: none;
    stroke: rgba(255, 255, 255, 0.18);
    stroke-width: 1.6;
  }
  @keyframes blink {
    50% {
      opacity: 0.3;
    }
  }
  .outer-node {
    fill: transparent;
    stroke: rgba(255, 255, 255, 0.9);
    stroke-width: 1.6px;
    transition: stroke 0.3s ease;
  }
  .inner-node {
    fill: rgba(255, 255, 255, 0.9);
    animation: blink 1s infinite ease-in-out;
    transition:
      r 0.3s ease,
      fill 0.3s ease,
      filter 0.3s ease;
  }
  .item:hover .inner-node {
    animation: none;
    r: 12;
    fill: var(--color-title);
    filter: drop-shadow(0 0 15px var(--color-title))
      drop-shadow(0 0 5px var(--color-title)) brightness(1.3);
  }
  .item:hover .outer-node {
    stroke: transparent;
  }
  strong {
    font-weight: 800;
    font-size: 14px;
  }
</style>
