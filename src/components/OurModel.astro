---
import { getLangFromUrl } from "@/i18n/utils";
import { translations } from "@/i18n";
import Button_MoreInformation from "./Button_MoreInformation.astro";

const lang = getLangFromUrl(Astro.url);
const i18n = await translations[lang]();
---

<script src="../scripts/card3d.js"></script>

<div
  id="our-model"
  class="max-w-6xl h-full mx-auto flex flex-col gap-12 px-6 py-12"
>
  <h1
    data-aos="fade-up"
    data-aos-duration="1000"
    class="mt-4 title-text text-center lg:text-left mb-4"
  >
    <span class="decoration text-[var(--color-title)]">+</span>
    {i18n.OUR_MODEL.TITLE}
  </h1>

  <!-- Timeline Horizontal Desktop -->
  <div class="hidden lg:block relative mt-12">
    <!-- Línea horizontal -->
    <div
      class="mb-18 left-0 right-0 h-0.5 bg-gradient-to-r from-[var(--color-title)]/20 via-[var(--color-title)] to-[var(--color-title)]/20"
    >
    </div>

    <!-- Cards horizontales -->
    <div class="grid grid-cols-4 gap-6">
      {
        i18n.OUR_MODEL.MODELS.map((model, index) => (
          <div
            data-aos="fade-up"
            data-aos-duration="1000"
            data-aos-delay={index * 200}
            class="relative card-3d-wrapper"
          >
            <div class="absolute -top-25 left-1/2 -translate-x-1/2 z-10 flex items-center justify-center w-12 h-12 rounded-full bg-[var(--color-bg-1)] border-2 border-[var(--color-title)] shadow-[0_0_20px_rgba(0,187,255,0.5)]">
              <span class="text-[var(--color-title)]">0{index + 1}</span>
            </div>

            <div class="card-3d relative glass-effect border h-full border-white/25 p-6 rounded-lg transition-transform duration-300 relative">
              <div class="flex items-center gap-3 mb-4">
                <div class="flex flex-shrink-0 justify-center items-center shadow-inner border border-white/15 rounded-lg w-16 h-16 transition-transform duration-300">
                  <img
                    src={model.ICON}
                    alt={model.TITLE}
                    class="w-10 object-contain"
                  />
                </div>
                <h2 class="!text-xl">{model.TITLE}</h2>
              </div>
              <p>{model.DESCRIPTION}</p>
              <div class="absolute -bottom-0.5 left-1/2 -translate-x-1/2 w-3/4 h-1 bg-[linear-gradient(to_right,transparent,var(--color-title),transparent)]" />
            </div>
          </div>
        ))
      }
    </div>
  </div>

  <!-- Timeline Mobile -->
  <div class="lg:hidden relative mt-8 pl-8">
    <!-- Línea vertical del timeline -->
    <div
      class="absolute left-3.5 top-0 bottom-0 w-0.5 bg-gradient-to-b from-[var(--color-title)] via-white/30 to-[var(--color-title)]"
    >
    </div>

    <div class="space-y-8">
      {
        i18n.OUR_MODEL.MODELS.map((model, index) => (
          <div
            data-aos="fade-left"
            data-aos-duration="1000"
            data-aos-delay={index * 150}
            class="relative"
          >
            <div class="absolute -left-[42px] top-4 flex items-center justify-center w-12 h-12 rounded-full bg-[var(--color-bg-1)] border-2 border-[var(--color-title)] shadow-[0_0_15px_rgba(0,187,255,0.4)] z-10">
              <span class=" text-[var(--color-title)]">0{index + 1}</span>
            </div>
            <div class="glass-effect border border-white/25 p-5 rounded-lg relative ml-4">
              <div class="flex items-center gap-3 mb-4">
                <div class="flex flex-shrink-0 justify-center items-center shadow-inner border border-white/15 rounded-lg w-14 h-14 transition-transform duration-300">
                  <img
                    src={model.ICON}
                    alt={model.TITLE}
                    class="w-8 object-contain"
                  />
                </div>
                <h2 class="!text-lg text-[var(--color-title)]">
                  {model.TITLE}
                </h2>
              </div>
              <p>{model.DESCRIPTION}</p>
              <div class="absolute bottom-1 left-1/2 -translate-x-1/2 w-2/3 h-1 bg-[var(--color-title)] rounded-full" />
            </div>
          </div>
        ))
      }
    </div>
  </div>

  <!-- Textos animados -->
  <div class="relative h-48 flex items-center justify-center mt-8 py-12">
    <div
      id="rotating-texts"
      class="relative z-10 flex items-center justify-center w-full"
    >
      {
        i18n.OUR_MODEL.TEXT.map((text, index) => (
          <h2
            class={`rotating-text absolute text-center shadow-text !text-4xl lg:!text-5xl !font-black  px-4 ${index === 0 ? "active" : ""}`}
            data-index={index}
            set:html={text}
          />
        ))
      }
    </div>
  </div>
</div>

<style>
  .rotating-text {
    opacity: 0;
    transform: scale(0.8);
    transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
    position: absolute;
    z-index: 10;
    filter: blur(5px);
  }

  .rotating-text.active {
    opacity: 1;
    transform: scale(1);
    filter: blur(0px);
  }

  .rotating-text.exit {
    opacity: 0;
    transform: scale(1.2);
    filter: blur(5px);
  }

  .card-3d {
    transform-style: preserve-3d;
    transition: transform 0.3s ease-out;
    position: relative;
    overflow: hidden;
  }

  .card-3d::before {
    content: "";
    position: absolute;
    top: -150%;
    left: -150%;
    width: 400%;
    height: 400%;
    background: linear-gradient(
      var(--angle, 115deg),
      transparent 30%,
      rgba(255, 255, 255, 0.04) 47%,
      rgba(255, 255, 255, 0.07) 50%,
      rgba(255, 255, 255, 0.04) 53%,
      transparent 70%
    );
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 1;
  }

  .card-3d:hover::before {
    opacity: 1;
  }

  .card-3d > * {
    position: relative;
    z-index: 2;
  }

  .card-3d > div:last-child {
    position: absolute !important;
    z-index: 2;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const texts = document.querySelectorAll(".rotating-text");
    let currentIndex = 0;

    function rotateTexts() {
      const current = texts[currentIndex];
      const next = texts[(currentIndex + 1) % texts.length];

      current.classList.add("exit");
      current.classList.remove("active");

      setTimeout(() => {
        current.classList.remove("exit");
        next.classList.add("active");
        currentIndex = (currentIndex + 1) % texts.length;
      }, 1000);
    }

    setInterval(rotateTexts, 4000);
  });
</script>
